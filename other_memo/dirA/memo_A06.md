python comment3.py /home/hoge/34_react_rensyu/nextjs-fastapi-template/fastapi_backend/app/routes -b 3



使い方

・まずインストール
npm install -g @github/copilot

copilot
で対話モードにはいり

/login
でgithub.comにログインし、ログイン状態にする。

■MCPサーバの設定
~/.copilot/mcp-config.json を開く。なければ新規作成せよ。

{
  "mcpServers": {
    "serena": {
      "tools": [
        "*"
      ],
      "type": "local",
      "command": "uvx",
      "args": [
        "--from",
        "git+https://github.com/oraios/serena",
        "serena",
        "start-mcp-server"
      ]
    },
    "chrome-devtools": {
      "type": "local",
      "command": "npx",
      "tools": [
        "*"
      ],
      "args": [
        "chrome-devtools-mcp@latest"
      ]
    },
    "fetch-mcp": {
      "type": "local",
      "command": "npx",
      "tools": [
        "*"
      ],
      "args": [
        "mcp-fetch-server"
      ]
    }
  }
}

一度再起動したほうがいいかも。



■実行する前に
対象のコードベースに対して、
「serenaのmcpサーバを用いて、コードベースを把握して」と動作確認するべし。
と実行すること。

■ツールの使い方
# コードファイル日本語コメント自動追加ツール

## 概要
このツールは、Python、TypeScript、TSXファイルに対して、AIを活用して自動的に日本語コメントを追加するPythonスクリプトです。copilotコマンドとserenaのMCPサーバーを使用して、コードベース全体を理解した上で、初心者にも分かりやすいコメントを挿入します。

## 主な機能

### ✨ 特徴
- 🤖 **AI駆動**: copilot（Claude Sonnet 4）を使用した高品質なコメント生成
- 📚 **コードベース理解**: serenaのMCPサーバーでコード全体を把握
- 🎯 **複数拡張子対応**: `.py`、`.tsx`、`.ts`ファイルに対応
- 📦 **バッチ処理**: 複数ファイルをまとめて効率的に処理
- 🔍 **スマート検索**: ディレクトリの再帰的検索とファイルの直接指定に対応
- ⚡ **空ファイルスキップ**: `__init__.py`などの空ファイルを自動でスキップ
- 🛑 **安全な中断**: Ctrl+Cでいつでも処理を中断可能
- 📊 **詳細なレポート**: 処理結果の統計情報を表示

## 前提条件

### 必須要件
- Python 3.6以上
- copilotコマンドがインストール済み
- serenaのMCPサーバーへのアクセス権限
- 対象ファイルへの読み書き権限

### 動作環境
- macOS
- Windows WSL2
- Linux

## インストール

追加ライブラリのインストールは不要です。標準ライブラリのみで動作します。

```bash
# スクリプトをダウンロードまたは作成
wget code_comment_tool.py
# または
curl -O code_comment_tool.py

# 実行権限を付与（Unix系の場合）
chmod +x code_comment_tool.py
```

## 使用方法

### 基本的な使い方

```bash
# ディレクトリを指定
python code_comment_tool.py ./src

# 複数ディレクトリを指定
python code_comment_tool.py ./src ./components ./utils

# ファイルを直接指定
python code_comment_tool.py main.py utils.py config.ts

# ディレクトリとファイルを混在指定
python code_comment_tool.py ./src main.py ./components
```

### オプション

#### `--batch-size` / `-b`
一度に処理するファイル数を指定（デフォルト: 5）

```bash
# 10ファイルずつまとめて処理
python code_comment_tool.py ./src --batch-size 10

# 省略形
python code_comment_tool.py ./src -b 10

# 1ファイルずつ処理（従来の動作）
python code_comment_tool.py ./src -b 1
```

### バッチサイズの推奨設定

| プロジェクト規模 | 推奨バッチサイズ | 説明 |
|-----------------|----------------|------|
| 小規模 | 3-5 | 関連性の高いファイルを効率的に処理 |
| 中規模 | 5-10 | バランスの良い処理速度とコンテキスト共有 |
| 大規模 | 10-20 | 大量ファイルの高速処理 |
| デバッグ時 | 1 | 問題の特定が容易 |

## 処理フロー

### 1. パス検証
```
指定されたパスを確認中...
  ✓ [ディレクトリ] /home/user/project/src
  ✓ [ファイル] /home/user/project/main.py
```

### 2. ファイル検索
```
============================================================
ファイル検索中...
============================================================

検索対象ディレクトリ: 2個
直接指定ファイル: 1個
```

### 3. 実行確認
```
============================================================
【実行確認】
============================================================

検出されたファイル:
  処理対象: 23 ファイル
  空ファイル（スキップ）: 3 ファイル
  合計: 26 ファイル

バッチ処理設定:
  バッチサイズ: 5 ファイル/バッチ
  バッチ数: 5 バッチ

処理対象ファイルの詳細:
  .py: 15 ファイル
  .ts: 5 ファイル
  .tsx: 3 ファイル

============================================================
※ 処理中はCtrl+Cで中断可能
============================================================

23個のファイルを5個ずつ処理します。続行しますか？ (はい/いいえ): 
```

### 4. バッチ処理実行
```
==================================================
バッチ 1/5 の処理を開始
対象ファイル数: 5個
==================================================
  [1] main.py
      パス: /home/user/project/main.py
      サイズ: 2,456 bytes
  [2] utils.py
      パス: /home/user/project/utils.py
      サイズ: 1,234 bytes
  ...

処理を実行中...
✓ バッチ処理完了
```

### 5. 処理結果サマリー
```
============================================================
処理完了
============================================================
  成功: 23 ファイル
  失敗: 0 ファイル
  スキップ: 3 ファイル（空ファイル）
  処理対象合計: 23 ファイル
  検出ファイル総数: 26 ファイル

バッチ処理:
  完了バッチ: 5/5
  バッチサイズ: 5 ファイル/バッチ
```

## 生成されるコメントの特徴

### コメントの内容
1. **ライブラリの説明**（最重要）
   - インポートされたライブラリの用途と機能
   
2. **関数・クラスの概要**
   - 各関数やクラスの目的と動作
   
3. **難しい箇所の補足**
   - 複雑なロジックや処理の解説
   
4. **コードベース内での役割**
   - ファイル冒頭に、そのファイルがプロジェクト全体でどんな役割を果たすか記述

### コメントのスタイル
- 高校生初心者でも理解できる平易な日本語
- 英語コメントは全て日本語に翻訳
- 豊富なコメント量で理解を促進
- 元のソースコードの処理内容は変更しない

## 中断機能

処理中にCtrl+Cを押すと安全に中断できます：

```
^C
============================================================
【中断】処理を中断しています...
============================================================

============================================================
処理中断
============================================================
  成功: 10 ファイル
  失敗: 0 ファイル
  未処理: 13 ファイル（中断）
  スキップ: 3 ファイル（空ファイル）
```

## エラー処理

### よくあるエラーと対処法

| エラーメッセージ | 原因 | 対処法 |
|----------------|------|--------|
| `'copilot'コマンドが見つかりません` | copilotが未インストール | copilotをインストール |
| `存在しません` | 指定パスが無効 | パスを確認して再実行 |
| `対象外の拡張子です` | サポート外のファイル形式 | .py/.tsx/.tsファイルを指定 |
| `ディレクトリでもファイルでもありません` | 特殊なファイル | 通常のファイル/ディレクトリを指定 |

## 終了コード

| コード | 意味 |
|-------|------|
| 0 | 正常終了 |
| 1 | エラーあり |
| 130 | Ctrl+Cによる中断 |

## 実行例

### 例1: Pythonプロジェクト全体を処理
```bash
python code_comment_tool.py ~/my_python_project --batch-size 8
```

### 例2: 特定のTypeScriptファイルのみ処理
```bash
python code_comment_tool.py App.tsx components/Header.tsx utils.ts
```

### 例3: 複数ディレクトリを小さいバッチで処理
```bash
python code_comment_tool.py ./frontend ./backend -b 3
```

### 例4: srcフォルダ内を再帰的に検索して処理
```bash
python code_comment_tool.py ./src
```

## 注意事項

### ⚠️ 重要な注意点
1. **バックアップ推奨**: 処理前に対象ファイルのバックアップを推奨
2. **Git管理下での使用**: 変更を容易に確認・取り消しできるよう、Git管理下での使用を推奨
3. **処理時間**: ファイル数やサイズにより処理に時間がかかる場合があります
4. **API制限**: copilotのAPI制限に注意してください

### 💡 ベストプラクティス
1. **段階的な処理**: 大規模プロジェクトは部分的に処理
2. **レビューの実施**: 生成されたコメントのレビュー
3. **バージョン管理**: 処理前後でのコミット
4. **適切なバッチサイズ**: プロジェクトサイズに応じた調整

## トラブルシューティング

### Q: 処理が遅い
A: バッチサイズを増やすことで処理速度が向上する可能性があります
```bash
python code_comment_tool.py ./src --batch-size 15
```

### Q: メモリ不足エラー
A: バッチサイズを小さくして実行
```bash
python code_comment_tool.py ./src --batch-size 2
```

### Q: 特定のファイルで失敗する
A: バッチサイズを1にして問題のファイルを特定
```bash
python code_comment_tool.py problem_file.py -b 1
```

### Q: 空ファイルも処理したい
A: 現在のバージョンでは空ファイルは自動スキップされます。必要な場合は、事前に内容を追加してください。
